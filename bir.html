<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Special Surprise ‚ú®</title>
    <!-- Import dreamy fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Nunito:wght@300;600;800&display=swap" rel="stylesheet">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-1: #ff9a9e;
            --bg-2: #fad0c4;
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.6);
            --accent-pink: #ff6b81;
            --paper-color: #fdfbf7;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            height: 100dvh; 
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(120deg, var(--bg-1) 0%, var(--bg-2) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        /* --- Ambient Background Particles --- */
        .bg-particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: none;
            animation: floatUp linear infinite;
        }
        /* --- Continuous Balloons --- */
        #balloon-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        .balloon {
            position: absolute;
            bottom: -100px;
            width: 30px;
            height: 40px;
            background: var(--accent-pink);
            border-radius: 50%;
            opacity: 0.8;
            animation: floatBalloon 15s linear infinite;
        }
        .balloon::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 10px;
            background: rgba(255,255,255,0.8);
        }
        /* --- Game Interface --- */
        #game-ui {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 50;
            pointer-events: none;
        }
        .instruction-toast {
            position: absolute;
            top: 17%; width: 90%; left: 5%;
            text-align: center; color: white;
            font-size: 1.5rem; font-weight: 800;
            text-shadow: 0 2px 10px rgba(232, 67, 147, 0.4);
            pointer-events: auto;
            transition: opacity 0.5s;
            animation: pulseText 2s infinite;
        }
        .progress-bar-container {
            position: absolute;
            top: 30px; left: 50%; transform: translateX(-50%);
            width: 80%; max-width: 300px; height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 50px; border: 2px solid rgba(255,255,255,0.8);
            overflow: hidden; pointer-events: auto;
            display: none;
        }
        .progress-fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, #ff9ff3, #feca57);
            transition: width 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .game-heart {
            position: absolute;
            font-size: 2.5rem; padding: 10px;
            cursor: pointer;
            animation: floatGame 6s linear infinite;
            pointer-events: auto;
            z-index: 60;
        }
        /* --- Main Card Container --- */
        .glass-card {
            position: relative;
            width: 90%; max-width: 500px;
            min-height: 50vh; max-height: 90vh;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 20px;
            z-index: 100;
            transform: scale(0.8); opacity: 0;
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
            overflow: hidden;
        }
        .glass-card.visible { transform: scale(1); opacity: 1; }
        
        h1.title {
            font-family: 'Great Vibes', cursive;
            font-size: clamp(2.5rem, 8vw, 4rem);
            color: #fff; margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            line-height: 1.2; width: 100%;
        }
        .subtitle {
            font-size: clamp(1rem, 4vw, 1.2rem);
            color: #fff; margin-top: 10px;
            font-weight: 600; opacity: 0.9;
        }

        /* --- Stage 1: Gift Box --- */
        .gift-wrapper {
            position: relative; margin-top: 30px;
            width: clamp(100px, 30vw, 150px); aspect-ratio: 1;
            cursor: pointer; transition: transform 0.3s ease;
        }
        .gift-wrapper:hover { transform: scale(1.05) rotate(3deg); }
        .box-body {
            position: absolute; bottom: 0; width: 100%; height: 85%;
            background: linear-gradient(to bottom right, #fff0f5, #ffd1dc);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(232, 67, 147, 0.3);
            display: flex; justify-content: center;
            overflow: hidden;
        }
        .box-lid {
            position: absolute; top: 0; left: -5%; width: 110%; height: 25%;
            background: #ffffff; border-radius: 6px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 2;
        }
        .box-ribbon {
            position: absolute; width: 20%; height: 100%;
            background: var(--accent-pink); left: 50%; transform: translateX(-50%); z-index: 1;
        }
        .lid-bow {
            position: absolute; top: -20%; left: 50%; transform: translateX(-50%);
            width: 50%; height: 30%;
        }
        .lid-bow::before, .lid-bow::after {
            content: ''; position: absolute;
            width: 45%; height: 100%;
            border: 4px solid var(--accent-pink); border-radius: 50%; top: 0;
        }
        .lid-bow::before { left: 0; transform: skew(10deg); }
        .lid-bow::after { right: 0; transform: skew(-10deg); }

        /* --- Stage 2: Envelope --- */
        .envelope-container {
            position: relative;
            width: clamp(180px, 50vw, 240px);
            height: clamp(120px, 35vw, 160px);
            background: #ff7675;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            margin-top: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            transition: transform 0.3s;
        }
        .envelope-container:hover { transform: scale(1.05); }
        .flap {
            position: absolute; top: 0; left: 0;
            width: 0; height: 0;
            border-left: clamp(90px, 25vw, 120px) solid transparent;
            border-right: clamp(90px, 25vw, 120px) solid transparent;
            border-top: clamp(60px, 18vw, 90px) solid #ff5252;
            transform-origin: top;
            transition: transform 0.6s ease 0.5s, z-index 0.2s;
            z-index: 5;
        }
        .envelope-container.open .flap { transform: rotateX(180deg); z-index: 1; }
        .pocket {
            position: absolute; bottom: 0; left: 0;
            width: 0; height: 0;
            border-left: clamp(90px, 25vw, 120px) solid transparent;
            border-right: clamp(90px, 25vw, 120px) solid transparent;
            border-bottom: clamp(60px, 18vw, 80px) solid #ff7675;
            z-index: 4;
        }
        .pocket-front {
            position: absolute; bottom: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.1) 100%);
            z-index: 6; pointer-events: none;
        }
        .letter-content {
            display: none; flex-direction: column; align-items: center; width: 100%;
            animation: fadeIn 1s ease forwards;
        }

        /* --- Stage 2.5: Pinky Promise --- */
        .promise-stage {
            display: none; flex-direction: column; align-items: center; width: 100%;
            opacity: 0; transition: opacity 1s ease;
        }
        .hand-container {
            display: flex; justify-content: center; align-items: center;
            font-size: clamp(60px, 15vw, 80px);
            margin: 20px 0;
            cursor: pointer;
        }
        .hand-left {
            transform: scaleX(-1) rotate(20deg);
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-right: 20px;
        }
        .hand-right {
            transform: rotate(20deg);
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-left: 20px;
        }
        .hand-container.locked .hand-left {
            transform: scaleX(-1) rotate(0deg) translateX(30px);
        }
        .hand-container.locked .hand-right {
            transform: rotate(0deg) translateX(-30px);
        }

        /* --- Stage 3: Cake --- */
        .cake-stage {
            display: none; flex-direction: column; align-items: center;
            opacity: 0; transition: opacity 1s ease; width: 100%;
        }
        .cake-container {
            position: relative; width: 200px; height: 200px;
            margin-top: 30px; transform-origin: center bottom;
        }
        .cake-base {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 160px; height: 80px; background: #ff9ff3;
            border-radius: 10px; box-shadow: inset -10px 0 0 rgba(0,0,0,0.05);
        }
        .cake-layer-top {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            width: 120px; height: 60px; background: #feca57;
            border-radius: 10px 10px 0 0; box-shadow: inset -10px 0 0 rgba(0,0,0,0.05); z-index: 2;
        }
        .cake-icing {
            position: absolute; top: 0; left: -5px; width: 108%; height: 25px;
            background: #fff; border-radius: 20px; z-index: 3;
        }
        .cake-icing::before { content: ''; position: absolute; width: 15px; height: 15px; top: 15px; left: 10px; background: #fff; border-radius: 0 0 20px 20px; box-shadow: 20px 5px 0 #fff, 40px -2px 0 #fff, 60px 8px 0 #fff; }
        .plate {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 200px; height: 15px; background: #ddd; border-radius: 50%;
        }
        .candle-container {
            position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
            width: 12px; height: 40px;
            background: repeating-linear-gradient(45deg, #fff, #fff 5px, #ff6b81 5px, #ff6b81 10px);
            z-index: 4; border-radius: 2px;
        }
        .flame {
            position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 25px; background: #ffda79;
            border-radius: 50% 50% 20% 20%;
            box-shadow: 0 0 10px #ffda79, 0 0 20px #ff9f43;
            animation: flicker 0.5s infinite alternate; cursor: pointer; z-index: 10;
        }
        .flame.out { transform: translateX(-50%) scale(0); opacity: 0; }

        /* --- Stage 4: Scratch Card --- */
        .scratch-stage {
            display: none; flex-direction: column; align-items: center;
            width: 100%; opacity: 0; transition: opacity 1s ease;
        }
        .scratch-container {
            position: relative; width: 250px; height: 250px; margin: 20px auto;
            border: 4px solid #fff; border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); overflow: hidden; background: white;
        }
        .scratch-image {
            width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 1;
        }
        .scratch-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; cursor: crosshair; touch-action: none;
        }

        /* --- Reasons Modal --- */
        .modal {
            display: none; position: fixed; z-index: 10000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.4);
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            margin: 15% auto; padding: 20px; border-radius: 20px;
            width: 80%; max-width: 400px; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 2px solid var(--accent-pink);
            animation: popIn 0.3s ease;
        }
        .close-modal {
            color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .close-modal:hover { color: #000; }
        .reason-text {
            font-size: 1.2rem; color: #e84393; margin: 20px 0; font-weight: bold; font-family: 'Great Vibes', cursive; font-size: 2rem;
        }

        /* Shared Components */
        .photo-frame {
            width: clamp(120px, 35vw, 160px); height: clamp(120px, 35vw, 160px);
            background: white; padding: 5px; border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 15px;
            overflow: hidden; flex-shrink: 0;
            animation: floatPhoto 4s ease-in-out infinite;
        }
        .photo-frame img {
            width: 100%; height: 100%; border-radius: 50%; object-fit: cover;
            border: 2px solid #ffdde1; transition: opacity 0.5s ease-in-out;
        }
        .letter-text {
            font-size: clamp(0.9rem, 3.5vw, 1.1rem); line-height: 1.5; color: #fff;
            background: rgba(255,255,255,0.15); padding: 15px; border-radius: 15px;
            margin-top: 10px; max-height: 25vh; overflow-y: auto;
            text-align: left; width: 100%;
        }
        .btn-action {
            margin-top: 15px; padding: 12px 30px; border: none;
            background: white; color: var(--accent-pink);
            font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 1.1rem;
            border-radius: 50px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s, background 0.2s;
            animation: pulseText 2s infinite;
        }
        .btn-action:hover { transform: scale(1.05); background: #fff0f5; }

        /* Animations */
        @keyframes floatUp { 0% { transform: translateY(110vh) scale(0); opacity: 0; } 50% { opacity: 0.6; } 100% { transform: translateY(-10vh) scale(1); opacity: 0; } }
        @keyframes floatBalloon { 0% { transform: translateY(0) rotate(0deg); opacity: 0.8; } 100% { transform: translateY(-120vh) rotate(20deg); opacity: 0; } }
        @keyframes floatGame { 0% { transform: translateY(110vh) rotate(0deg); } 100% { transform: translateY(-20vh) rotate(360deg); } }
        @keyframes pulseText { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes flicker { 0% { transform: translateX(-50%) skewX(-2deg) scale(1); opacity: 1; } 100% { transform: translateX(-50%) skewX(2deg) scale(0.95); opacity: 0.8; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }

        /* --- THE LEGEND BUTTON --- */
        .Legend {
            text-decoration: none; color: #fdfbf7; height: auto; width: fit-content;
            padding: 12px 20px; background-color: red; border-radius: 50px;
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 99999; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); white-space: nowrap;
        }

        /* --- NEW: Game Menu Button (Top Right) --- */
        .game-link-btn {
            position: fixed;
            top: 70px;
            right:50px;
            background: white;
            color: #ff6b81;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 800;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            transition: transform 0.2s;
            font-family: 'Nunito', sans-serif;
            display: flex;
            align-items: center;    
            justify-content: center;
            gap: 8px;
        }
        .game-link-btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>

    <div id="ambient-bg"></div>
    <div id="balloon-bg"></div>

    <!-- NEW: Game Menu Button -->
    <a href="games_menu.html" class="game-link-btn">üéÆ Play Games</a>

    <!-- Mini Game UI -->
    <div id="game-ui">
        <div class="progress-bar-container" id="progress-container">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="instruction-toast" id="instructions">
            Catch 5 Hearts to unlock the surprise!
        </div>
        <div id="heart-spawner"></div>
    </div>

    <!-- Main Card -->
    <div class="glass-card hidden" id="main-card">
        
        <!-- 1. Gift Box -->
        <div id="gift-stage" style="width:100%; display:flex; flex-direction:column; align-items:center;">
            <h1 class="title">You made itüëç</h1>
            <p class="subtitle">Just one more tap...</p>
            
            <div class="gift-wrapper" id="gift-btn">
                <div class="lid-bow"></div>
                <div class="box-lid"><div class="box-ribbon"></div></div>
                <div class="box-body"><div class="box-ribbon"></div></div>
            </div>
        </div>

        <!-- 2. Envelope Stage -->
        <div id="envelope-stage" class="hidden" style="width:100%; display:flex; flex-direction:column; align-items:center;">
            <h1 class="title">Letter for my princess<br>(The Gudiya)</h1>
            <p class="subtitle" id="env-hint">Tap to open...</p>
            
            <div class="envelope-container" id="envelope-btn">
                <div class="flap"></div>
                <div class="pocket"></div>
                <div class="pocket-front"></div>
            </div>

            <div class="letter-content" id="opened-letter-content">
                <div class="photo-frame">
                    <img id="slideshow-img" src="" alt="Birthday Girl">
                </div>
                <div class="letter-text" id="typewriter-area"></div>
                <!-- Goes to Promise Stage now -->
                <button class="btn-action hidden" id="to-promise-btn">Make a Promise ü§û</button>
            </div>
        </div>

        <!-- 2.5 Pinky Promise Stage -->
        <div class="promise-stage" id="promise-stage">
            <h1 class="title">Pinky Promise?</h1>
            <p class="subtitle">Tap to see my promise...</p>
            
            <div class="hand-container" id="promise-hands-btn">
                <div class="hand-left">‚úã</div>
                <div class="hand-right">‚úã</div>
            </div>
            
            <p class="subtitle hidden" id="promise-msg">I promise to always irritate youüòÅ and never stop loving you! ‚ù§Ô∏è</p>
            <button class="btn-action hidden" id="to-cake-btn">Go to Cake üéÇ</button>
        </div>

        <!-- 3. Cake Stage -->
        <div class="cake-stage" id="cake-stage">
            <h1 class="title">Make a Wish...</h1>
            <p class="subtitle">Tap the candle flame to blow it out! ‚ú®</p>
            
            <div class="cake-container">
                <div class="plate"></div>
                <div class="cake-base"></div>
                <div class="cake-layer-top">
                    <div class="cake-icing"></div>
                    <div class="candle-container"><div class="flame" id="flame"></div></div>
                </div>
            </div>
            <p class="subtitle hidden" id="wished-msg" style="margin-top:20px; color:#fff;">May all your dreams come true!üéà<br>(avoiding boysü§û)</p>
            
            <button class="btn-action hidden" id="to-scratch-btn">One Last Surprise ‚ú®</button>
        </div>

        <!-- 4. Scratch Card Stage -->
        <div class="scratch-stage" id="scratch-stage">
            <h1 class="title">Hidden Memory</h1>
            <p class="subtitle">Scratch to reveal... ‚ù§Ô∏è</p>
            
            <div class="scratch-container">
                <img src="./img/7.jpeg" class="scratch-image" alt="Us">
                <canvas class="scratch-canvas" id="scratch-canvas"></canvas>
            </div>
            
            <h2 class="subtitle hidden" id="final-msg" style="margin-top:10px;">I Love My Gudiya! I Love To Irritate My Gudiya, You are mine.</h2>
            
            <!-- 100 Reasons Button -->
            <button class="btn-action hidden" id="reasons-btn" style="margin-top:15px; font-size:0.9rem;">Why I Love You?üåπ100-Reasons</button>
        </div>
    </div>

    <!-- Reasons Modal -->
    <div id="reason-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h1 class="title" style="color:#ff6b81; font-size:1.5rem;">Reason #<span id="reason-num">1</span></h1>
            <p class="reason-text" id="reason-text">...</p>
            <button class="btn-action" id="next-reason-btn" style="font-size:0.9rem;">Next Reason ‚ù§Ô∏è</button><br><br>
            <a href="./reasons.html" class="btn-action" id="next-reason-btn" style="font-size:0.9rem; text-decoration: none;">See 100 reason list</a>
        </div>
    </div>

    <!-- THE LEGEND BUTTON -->
    <a href="https://molaybera.github.io/portfolio/" class="Legend" target="_blank">The Legend himself</a>
    
    <script>
        /* --- Configuration --- */
        const CONFIG = {
            message: "Happy Birthday, my gorgeous girl (gudiya)! ‚ú® Your smile lights up my whole world, those eyes make me weak every single time. You're not just beautiful you're mine, all mine: those cute eyes, that killer smile, and every naughty little thought you hide üòè. I can't wait to steal more kisses and make you blush every singal time whenever i get chances. I love you endlessly like Pi (pi has infinity decimal so do my love towads you)",
            heartsToWin: 5,
            photos: [
                "./img/1.jpg", "./img/2.jpg", "./img/3.jpg", 
                "./img/4.png", "./img/5.jpg", "./img/6.jpg"
            ],
            reasons: [
                   "Your smile makes my day.", "You are my safe place.",
                   "The way you look at me.", "You tolerate my bad jokes.",
                   "Your kindness to everyone.", "How cute you look when angry.",
                   "You are my best friend.", "Your voice heals me.",
                   "We are perfect together.", "You make me a better person.",
                   "The way you say my name.", "Your laugh is my favorite sound.",
                   "You always believe in me.", "You give the best hugs even though you are the only person i have hug.",
                   "How much you care about us.", "You are the most beautiful girl, my girl.",
                   "Your silly side, nautanki, nakharey ....", "The way you play with my hair.",
                   "You understand me without words.", "You are my happy place.",
                   "I love your, no reason needed.", "You are my princess.",
                   "How you handle my irritation.", "You are my cutie pie.",
                   "Your come in my dream.", "I want to eat you.",
                   "You inspire me.", "Your morning texts.",
                   "How you listen to my words.", "You are my lucky charm.",
                   "The way you hold my hand.", "You are incredibly smart.",
                   "Your passion for things you love.", "You make boring days fun.",
                   "I love making memories with you.", "You are my dream come true.",
                   "How you cheer me up.", "Your confidence.",
                   "You have the purest heart.", "I love your drama (sometimesüòÇ).",
                   "You are worth every effort.", "How we can talk for hours.",
                   "The way you support my dreams.", "You are my sunshine.",
                   "I love annoying you.", "Your patience with me.",
                   "How you take care of me.", "You are simply adorable.",
                   "I love your scent.", "You make me feel loved.",
                   "You are my forever.", "Your ocean like eyes.",
                   "Love how i prank you.", "You are my home.",
                   "I love your honesty.", "You make my heart race.",
                   "I want to grow old with you.", "You are my motivation.",
                   "Your cute texting habits.", "You are my Gudiya.",
                   "How strong you are.", "I love your chicks, want to kiss them.",
                   "You complete me.", "Every moment with you is magic.",
                   "I want to fight with you (WWEüí™).", "You are my everything.",
                   "How you scold me.", "Your innocence.",
                   "You make the world beautiful.", "I love watching you sleep.",
                   "You are the reason I smile.", "Your unconditional love.",
                   "I love how little you are.", "You are my greatest gift.",
                   "How you make me feel strong.", "want to cuddle.",
                   "I love your cooking (trying to do üòÇ).", "You are my soulmate.",
                   "How you blush.", "I love stealing glances at you.",
                   "You make problems disappear.", "I love eye contact compition with you (i loss every timeü•∫).",
                   "I love our inside jokes.", "Because i am god üòÇ.",
                   "How you irritat me.", "I love your energy.",
                   "You are my pride.", "I love showing you off.",
                   "You make me want to be better.", "Your loyalty.",
                   "Because you are chudail.", "You are my peace.",
                   "How you eat food.", "I love your imperfections.",
                   "You are my greatest adventure.", "I love your touch.",
                   "You are the best thing in my life.", "I love you more than words.",
                   "Because you are mine, my girl.", "I choose you, every single day."
               ]
        };

        // --- PRELOADER ---
        CONFIG.photos.forEach(src => { const i = new Image(); i.src = src; });

        /* --- Game Logic --- */
        let score = 0;
        let gameActive = true;
        const heartSpawner = document.getElementById('heart-spawner');

        const spawnerInterval = setInterval(() => {
            if (!gameActive) return;
            const heart = document.createElement('div');
            heart.classList.add('game-heart');
            heart.innerHTML = ['üíó', 'üíò', 'üíù'][Math.floor(Math.random()*3)];
            heart.style.left = Math.random() * 80 + 10 + 'vw';
            heart.style.animationDuration = Math.random() * 3 + 4 + 's';
            
            const pop = (e) => {
                e.preventDefault(); e.stopPropagation();
                heart.style.transform = "scale(1.5)"; heart.style.opacity = "0";
                setTimeout(() => heart.remove(), 200);
                score++;
                document.getElementById('progress-fill').style.width = (score/CONFIG.heartsToWin)*100 + '%';
                if (score >= CONFIG.heartsToWin) winGame();
            };
            heart.addEventListener('click', pop);
            heart.addEventListener('touchstart', pop, {passive: false});
            heartSpawner.appendChild(heart);
            setTimeout(() => { if(heart.parentNode) heart.remove(); }, 7000);
        }, 800);

        document.getElementById('progress-container').style.display = 'block';

        function winGame() {
            gameActive = false; clearInterval(spawnerInterval);
            heartSpawner.innerHTML = '';
            document.getElementById('instructions').innerHTML = "Perfect! ‚ú®";
            setTimeout(() => {
                document.getElementById('game-ui').style.display = 'none';
                const card = document.getElementById('main-card');
                card.classList.remove('hidden');
                setTimeout(() => card.classList.add('visible'), 50);
            }, 1000);
        }

        /* --- Stage Transitions --- */

        // 1. Gift -> Envelope
        document.getElementById('gift-btn').addEventListener('click', () => {
            spawnBalloons(); 
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            document.getElementById('gift-stage').style.display = 'none';
            const envStage = document.getElementById('envelope-stage');
            envStage.classList.remove('hidden');
            envStage.style.display = 'flex';
        });

        // 2. Open Envelope
        document.getElementById('envelope-btn').addEventListener('click', function() {
            if(this.classList.contains('open')) return;
            this.classList.add('open');
            document.getElementById('env-hint').style.display = 'none';
            setTimeout(() => {
                this.style.display = 'none';
                document.getElementById('opened-letter-content').style.display = 'flex';
                typeWriter(document.getElementById('typewriter-area'), CONFIG.message);
                startSlideshow();
            }, 800);
        });

        // 3. Letter -> Pinky Promise
        document.getElementById('to-promise-btn').addEventListener('click', () => {
            const envStage = document.getElementById('envelope-stage');
            const promiseStage = document.getElementById('promise-stage');
            envStage.style.opacity = 0;
            setTimeout(() => {
                envStage.style.display = 'none';
                promiseStage.style.display = 'flex';
                setTimeout(() => promiseStage.style.opacity = 1, 50);
            }, 500);
        });

        // 4. Promise Interaction
        document.getElementById('promise-hands-btn').addEventListener('click', function() {
            if(this.classList.contains('locked')) return;
            this.classList.add('locked');
            
            // Change hands to crossed fingers emoji
            const leftHand = this.querySelector('.hand-left');
            const rightHand = this.querySelector('.hand-right');
            leftHand.innerText = 'ü§û';
            rightHand.innerText = 'ü§û';

            document.getElementById('promise-msg').classList.remove('hidden');
            confetti({ particleCount: 50, spread: 50 });
            setTimeout(() => {
                document.getElementById('to-cake-btn').classList.remove('hidden');
            }, 1000);
        });

        // 5. Promise -> Cake
        document.getElementById('to-cake-btn').addEventListener('click', () => {
            const promiseStage = document.getElementById('promise-stage');
            const cakeStage = document.getElementById('cake-stage');
            promiseStage.style.opacity = 0;
            setTimeout(() => {
                promiseStage.style.display = 'none';
                cakeStage.style.display = 'flex';
                setTimeout(() => cakeStage.style.opacity = 1, 50);
            }, 500);
        });

        // 6. Cake -> Scratch Card
        document.getElementById('to-scratch-btn').addEventListener('click', () => {
            const cakeStage = document.getElementById('cake-stage');
            const scratchStage = document.getElementById('scratch-stage');
            cakeStage.style.opacity = 0;
            setTimeout(() => {
                cakeStage.style.display = 'none';
                scratchStage.style.display = 'flex';
                initScratchCard();
                setTimeout(() => scratchStage.style.opacity = 1, 50);
            }, 500);
        });

        /* --- 100 Reasons Logic --- */
        const modal = document.getElementById('reason-modal');
        const reasonsBtn = document.getElementById('reasons-btn');
        const closeBtn = document.getElementsByClassName('close-modal')[0];
        const nextReasonBtn = document.getElementById('next-reason-btn');

        reasonsBtn.onclick = () => {
            showRandomReason();
            modal.style.display = "flex";
        }
        closeBtn.onclick = () => modal.style.display = "none";
        window.onclick = (event) => { if (event.target == modal) modal.style.display = "none"; }
        nextReasonBtn.onclick = () => showRandomReason();

        function showRandomReason() {
            const randomIdx = Math.floor(Math.random() * CONFIG.reasons.length);
            document.getElementById('reason-text').innerText = CONFIG.reasons[randomIdx];
            document.getElementById('reason-num').innerText = randomIdx + 1;
        }

        /* --- Helper Functions --- */

        // Slideshow - 1.5s transition
        function startSlideshow() {
            const img = document.getElementById('slideshow-img');
            let idx = 0;
            img.src = CONFIG.photos[0];
            setInterval(() => {
                img.style.opacity = 0;
                setTimeout(() => {
                    idx = (idx + 1) % CONFIG.photos.length;
                    img.src = CONFIG.photos[idx];
                    img.onload = () => { img.style.opacity = 1; };
                    setTimeout(() => { img.style.opacity = 1; }, 50); 
                }, 500); 
            }, 1500);
        }

        // Typewriter
        function typeWriter(el, text, i = 0) {
            if (i < text.length) {
                el.innerHTML += text.charAt(i);
                el.scrollTop = el.scrollHeight;
                setTimeout(() => typeWriter(el, text, i + 1), 40);
            } else {
                setTimeout(() => document.getElementById('to-promise-btn').classList.remove('hidden'), 500);
            }
        }

        // Balloons
        function spawnBalloons() {
            const bg = document.getElementById('balloon-bg');
            const colors = ['#ff9ff3', '#feca57', '#ff6b6b', '#48dbfb'];
            setInterval(() => {
                const b = document.createElement('div');
                b.classList.add('balloon');
                b.style.left = Math.random() * 100 + 'vw';
                b.style.background = colors[Math.floor(Math.random() * colors.length)];
                b.style.animationDuration = (Math.random() * 5 + 5) + 's';
                bg.appendChild(b);
                setTimeout(() => b.remove(), 10000);
            }, 500);
        }

        // Scratch Card Logic
        function initScratchCard() {
            const canvas = document.getElementById('scratch-canvas');
            const ctx = canvas.getContext('2d');
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth; canvas.height = container.offsetHeight;
            ctx.fillStyle = "#dfe6e9"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#636e72"; ctx.font = "bold 20px Nunito"; ctx.textAlign = "center";
            ctx.fillText("Scratch Here! ‚ù§Ô∏è", canvas.width/2, canvas.height/2);
            let isDrawing = false;
            
            function scratch(x, y) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath(); ctx.arc(x, y, 20, 0, Math.PI * 2); ctx.fill();
                if(Math.random() > 0.95) {
                    document.getElementById('final-msg').classList.remove('hidden');
                    document.getElementById('reasons-btn').classList.remove('hidden');
                }
            }
            function getPos(e) {
                const rect = canvas.getBoundingClientRect();
                let clientX = e.clientX; let clientY = e.clientY;
                if(e.touches && e.touches[0]) { clientX = e.touches[0].clientX; clientY = e.touches[0].clientY; }
                return { x: clientX - rect.left, y: clientY - rect.top };
            }
            const start = () => isDrawing = true;
            const end = () => isDrawing = false;
            const move = (e) => {
                if(!isDrawing) return; e.preventDefault();
                const pos = getPos(e); scratch(pos.x, pos.y);
            };
            canvas.addEventListener('mousedown', start); canvas.addEventListener('touchstart', start);
            window.addEventListener('mouseup', end); window.addEventListener('touchend', end);
            canvas.addEventListener('mousemove', move); canvas.addEventListener('touchmove', move, {passive: false});
        }

        // Cake Flame
        document.getElementById('flame').addEventListener('click', function() {
            this.classList.add('out');
            confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
            setTimeout(() => {
                document.getElementById('wished-msg').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('to-scratch-btn').classList.remove('hidden');
                }, 1000);
            }, 500);
        });
    </script>
</body>
</html>